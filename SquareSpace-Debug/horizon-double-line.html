<html>
  <style>
    .chart-wrapper {
      width: calc(100% - 20px);
      height: 100%;
      padding: 20px;
      line-height: 400px;
      font-family: Lato, Helvetica-Neue, monospace;
    }

    .chart-wrapper .chart-wrapper-header {
      color: var(--chart-header-text);
    }

    .charts-list {
      display: flex;
      flex-wrap: wrap;
      align-content: center;
      width: 100%;
      margin-bottom: 20px;
    }

    .chart-item {
      width: calc(80% + 40px);
      height: calc(600px + 40px);
      margin: 0 0 20px 20px;
      padding: 20px;
      background-color: rgba(256, 256, 256, 0.1);
      border: solid 1px white;
      border-radius: 2%;
      box-shadow: -1px -1px 2px rgba(73, 73, 73, 0.2) inset;
    }

    .chart-shake {
      animation: shake 0.82s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
      transform: translate3d(0, 0, 0);
      backface-visibility: hidden;
      perspective: 1000px;
    }
  </style>
</html>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.4.0/dist/chart.min.js"></script>
  <div class="chart-wrapper">
    <div class="charts-list">
      <div class="chart-item">
        <canvas id="doubleLineChart" class="chart-animation"></canvas>
      </div>
    </div>
  </div>
  <script>
    let chartPrimaryColor = ["rgba(0,45,114,1)"]; // Blue
    let chartSecondaryColor = ["rgba(250,194,31,1)"]; // Yellow
    let chartLabelColorDark = ["#d9d9d9"];
    let chartNeutralColorDark = ["#c7c7c7"]; // White

    // Fonts
    let chartPrimaryFont = ["Lato, Helvetica-Neue, monospace"];

    //////////////////////* Line & Pie Chart Lables *////////////////////////////
    // Line Chart Y-Axis
    let chartYearNames = ["FY21", "FY20", "FY19", "FY18", "FY17", "FY16"];

    // Line Chart Served & Raised
    let chartFundsRaised = [
      391959.5, 423216.0, 131775.0, 100184.98, 113775.0, 112070.0,
    ];
    let chartFundsServed = [95, 86, 72, 61, 45, 28];

    /////////////////////* Global Tools *///////////////////////////////
    // Custom Tooltip Position
    let tooltipPlugin = Chart.registry.getPlugin("tooltip");
    tooltipPlugin.positioners.myCustomPositioner = function (
      elements,
      eventPosition
    ) {
      let tooltip = this;
      return {
        x: eventPosition.x,
        y: eventPosition.y - 15,
      };
    };

    function doubleLineChart() {
      let ctx = $("#doubleLineChart")[0].getContext("2d");
      const blueBlackGradient = ctx.createLinearGradient(0, 0, 0, 600);
      blueBlackGradient.addColorStop(1, "rgba(0, 0, 0, 0.1)");
      blueBlackGradient.addColorStop(0, chartPrimaryColor);

      const yellowBlackGradient = ctx.createLinearGradient(0, 0, 0, 600);
      yellowBlackGradient.addColorStop(0.9, "rgba(0, 0, 0, 0.1)");
      yellowBlackGradient.addColorStop(0, chartSecondaryColor);

      let label = chartYearNames;
      let data1 = chartFundsServed;
      let data2 = chartFundsRaised;
      let data = {
        labels: label,
        datasets: [
          {
            label: "Students Served",
            data: data1,
            borderColor: chartPrimaryColor,
            pointBackgroundColor: "white",
            pointRadius: 4,
            pointHoverRadius: 15,
            yAxisID: "y",
            backgroundColor: blueBlackGradient,
            hoverBackgroundColor: yellowBlackGradient,
            hoverBorderColor: chartPrimaryColor,
            fill: true,
          },
          {
            label: "Funds Raised",
            data: data2,
            borderColor: chartSecondaryColor,
            pointBackgroundColor: "white",
            pointRadius: 4,
            pointHoverRadius: 15,
            yAxisID: "y1",
            backgroundColor: yellowBlackGradient,
            hoverBackgroundColor: chartSecondaryColor,
            hoverBorderColor: chartSecondaryColor,
            fill: true,
          },
        ],
      };
      let config = {
        type: "line",
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              displayColors: false,
              titleFont: {
                family: chartPrimaryFont,
                size: 20,
              },
              bodyFont: {
                family: chartPrimaryFont,
                size: 18,
              },
              yAlign: "bottom",
              position: "myCustomPositioner",
            },
          },
          scales: {
            y: {
              type: "linear",
              display: true,
              position: "left",
              beginAtZero: true,
              grid: {
                color: chartNeutralColorDark,
              },
              ticks: {
                color: chartNeutralColorDark,
                font: {
                  family: chartPrimaryFont,
                  weight: "bold",
                  size: 16,
                },
              },
              title: {
                display: true,
                text: "Students Served",
                color: chartLabelColorDark,
                font: {
                  family: chartPrimaryFont,
                  weight: "bold",
                  size: 20,
                },
              },
            },
            y1: {
              type: "linear",
              display: true,
              position: "right",
              beginAtZero: true,
              grid: {
                display: false,
              },
              ticks: {
                callback: function (value) {
                  return "$" + value / 1000 + "k";
                },
                color: chartNeutralColorDark,
                font: {
                  family: chartPrimaryFont,
                  weight: "bold",
                  size: 16,
                },
              },
              title: {
                display: true,
                text: "Funds Raised",
                color: chartLabelColorDark,
                font: {
                  family: chartPrimaryFont,
                  weight: "bold",
                  size: 20,
                },
              },
            },
            x: {
              grid: {
                color: chartNeutralColorDark,
              },
              ticks: {
                color: chartNeutralColorDark,
                font: {
                  family: chartPrimaryFont,
                  weight: "bold",
                  size: 16,
                },
              },
              title: {
                display: true,
                text: "Year",
                color: chartLabelColorDark,
                font: {
                  family: chartPrimaryFont,
                  weight: "bold",
                  size: 20,
                },
              },
            },
          },
        },
      };
      
      let chart;
  
      function callback(entries, observer) {
        entries.forEach((entry) => {
          if (entry.isIntersecting === true) {
            $("#doubleLineChart").parent().addClass("chart-shake");
            if (chart) {
              chart.destroy();
            }
            chart = new Chart(ctx, config);
          } else {
            $("#doubleLineChart").parent().removeClass("chart-shake");
          }
        });
      }
  
      const options = {
        root: null,
        rootMargin: "0px 0px 0px 0px",
        threshold: 1.0,
      };
  
      const observer = new IntersectionObserver(callback, options);
  
      const target = document.querySelectorAll(".chart-animation");
      target.forEach((item) => {
        if (item) {
          observer.observe(item);
        }
      });
    }

    $(document).ready(() => {
      doubleLineChart();
    });
  </script>
</body>
